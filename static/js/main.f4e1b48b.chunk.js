(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t){},134:function(e,t){},135:function(e,t){},182:function(e,t,n){},184:function(e,t,n){},186:function(e,t,n){"use strict";n.r(t);var s=n(6),a=n.n(s),r=n(85),i=n.n(r),o=n(3),c=n.n(o),u=n(8),l=n(20),h=n(21),d=n(87),p=n(86),f=n(88),v=n(16),m=n(7),g=function(){function e(t){Object(l.a)(this,e),this.hostname=t.hostname,this.useMobileNet=t.useMobileNet,this.mobilenet=!1,this.classifier=!1,this.modelName=!1}return Object(h.a)(e,[{key:"loadModel",value:function(){var e=Object(u.a)(c.a.mark(function e(t){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadClassifier(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"idbModelExists",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.c.listModels();case 2:if(n=e.sent,console.log(Object.keys(n)),0!==Object.keys(n).length){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",Object.keys(n).filter(function(e){return e.includes("indexeddb")&&e.split("://")[1]===t}).length>0);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadMobileNet",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t,n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.mobilenet&&this.mobilenet.dispose(),e.next=4,this.fetchModel("mobileNet");case 4:t=e.sent,n=t.getLayer("conv_pw_13_relu"),this.mobilenet=m.e({inputs:t.inputs,outputs:n.output}),console.log("mobileNet loaded"),e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(0),new Error(e.t0);case 13:case"end":return e.stop()}},e,this,[[0,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"loadClassifier",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchModel(t);case 3:n=e.sent,this.classifier=n,this.modelName=t,console.log("classifier loaded"),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),new Error(e.t0);case 12:case"end":return e.stop()}},e,this,[[0,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchModel",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n,s;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idbModelExists(t);case 2:if(!e.sent){e.next=11;break}return console.log("Loading ".concat(t," from IDB")),e.next=7,m.d("indexeddb://".concat(t));case 7:return n=e.sent,e.abrupt("return",n);case 11:return console.log("Loading ".concat(t," from local server")),e.next=14,m.d("".concat(this.hostname,"/").concat(t,"/model.json"));case 14:return(s=e.sent).save("indexeddb://".concat(t)).then(function(){return console.log("".concat(t," saved to IDB"))}).catch(function(e){return console.warn(e)}),e.abrupt("return",s);case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"classifyImage",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n,s;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.classifier&&(!this.useMobileNet||this.mobilenet)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.normalizeImage(t);case 4:return n=e.sent,e.next=7,this.predict(n);case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"normalizeImage",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.g(function(){var e=m.a(t);return n.cropImage(e).expandDims(0).toFloat().div(m.f(127)).sub(m.f(1))}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cropImage",value:function(e){var t=Math.min(e.shape[0],e.shape[1]),n=e.shape[0]/2-t/2,s=e.shape[1]/2-t/2;return e.slice([n,s,0],[t,t,3])}},{key:"predict",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n,s,a=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.g(function(){return a.useMobileNet&&(t=a.mobilenet.predict(t)),a.classifier.predict(t).as1D()}),e.next=3,n.data();case 3:return s=e.sent,n.dispose(),e.abrupt("return",s);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),b=n(19),w=function(){function e(){Object(l.a)(this,e),this.ASSETS_URL="http://127.0.0.1:8085/nnModels/",this.MODEL_URL="".concat(this.ASSETS_URL,"/converted-sessionmodel/tensorflowjs_model.pb"),this.WEIGHTS_URL="".concat(this.ASSETS_URL,"/converted-sessionmodel/weights_manifest.json"),this.IMAGE_SIZE=224,this.labels=["closed","opened"],this.model=!1}return Object(h.a)(e,[{key:"loadModel",value:function(){var e=Object(u.a)(c.a.mark(function e(){var t,n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)(this.MODEL_URL,this.WEIGHTS_URL);case 2:return t=e.sent,n=m.h([1,this.IMAGE_SIZE,this.IMAGE_SIZE,3]),e.next=6,t.executeAsync({input:n});case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"classifyImage",value:function(){var e=Object(u.a)(c.a.mark(function e(t){var n,s,a,r,i,o,u,l,h,d=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=performance.now(),s=m.a(t).toFloat(),a=m.b.resizeBilinear(s,[this.IMAGE_SIZE,this.IMAGE_SIZE]),r=m.f(127.5),i=a.sub(r).div(r),o=i.expandDims(0),e.next=8,m.g(function(){return d.model.predict({input:o})}).data();case 8:return u=e.sent,l=this.labels.map(function(e,t){return{label:e,accuracy:u[t]}}).sort(function(e,t){return t.accuracy-e.accuracy}),h="".concat((performance.now()-n).toFixed(1)," ms"),e.abrupt("return",{predictions:l,time:h});case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(u.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadModel();case 2:this.model=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),y=(n(182),[{description:"Open hand recognition",modelName:"hands2-93-0.9880",labels:["close","open"],explainers:["classes/closed.jpg","classes/opened.jpg"]},{description:"Open hand & fingers recognition (very raw)",modelName:"handsMulti-47-0.8496",labels:["0","1","2","3","4","5","6","7","8","9","q","w","x","z"],explainers:["classes/0.jpg","classes/1.jpg","classes/2.jpg","classes/3.jpg","classes/4.jpg","classes/5.jpg","classes/6.jpg","classes/7.jpg","classes/8.jpg","classes/9.jpg","classes/q.jpg","classes/w.jpg","classes/x.jpg"]}]),x=function(e){return(100*e).toFixed(2)},k=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(d.a)(this,Object(p.a)(t).call(this))).handleKeyPress=function(t){e.listenKeys&&e.saveSnaps!==t.key&&(e.saveSnaps=t.key,console.log("Saving images of ".concat(t.key," class")))},e.handleKeyPressUp=function(t){e.saveSnaps=null},e.snapsPerSecond=3,e.predictionsPerSecond=10,e.predictionQueueCap=5,e.listenKeys=!0,e.state={classifier:!1,gestIndex:0,predIndex:[],model:y[0]},e.gestureLoading=!1,e.gestureLast=Date.now(),e.snapLast=Date.now(),e.saveSnaps=null,e.snapsInProcessing=0,e.snapShot=e.snapShot.bind(Object(v.a)(Object(v.a)(e))),e.classifyBox=e.classifyBox.bind(Object(v.a)(Object(v.a)(e))),e}return Object(f.a)(t,e),Object(h.a)(t,[{key:"setup",value:function(e,t){var n=[window.innerWidth,window.innerHeight],s=n[0],a=n[1],r=e.videoWidth/e.videoHeight;r>s/a?(t.width=s,t.height=s/r,t.style.top=0-(t.height/2-a/2)):(t.height=a,t.width=a*r,t.style.left=0-(t.width/2-s/2))}},{key:"webCamLoaded",value:function(e){var t=this;this.video=document.createElement("video"),this.video.srcObject=e,this.video.style.display="none",document.body.appendChild(this.video),this.video.onloadedmetadata=function(e){t.setup(t.video,t.cvs),t.video.play(),t.snapShot()}}},{key:"snapShot",value:function(){var e=Object(u.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.ctx&&(this.updateDetectBoxes(),this.state.classifier&&this.classifyBox()),requestAnimationFrame(this.snapShot);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"printScore",value:function(e){console.log("%c".concat((100*e).toFixed(2),"% (").concat(this.snapsInProcessing,")"),"margin-left: 15px; color: blue; font-size:15px; background: white; padding: 5px; border-radius: 5px;")}},{key:"classifyBox",value:function(){var e=this;!this.gestureLoading&&Date.now()-this.gestureLast>1e3/this.predictionsPerSecond&&this.snapsInProcessing<this.predictionQueueCap&&(this.snapsInProcessing++,this.gestureLoading=!0,this.gestureLast=Date.now(),this.state.classifier.classifyImage(this.outCnv).then(function(t){e.snapsInProcessing--,e.gestureLoading=!1,e.setState({predIndex:t})}))}},{key:"updateDetectBoxes",value:function(){var e=window.innerHeight/2;this.ctx.drawImage(this.video,0,0,this.cvs.width,this.cvs.height),this.ctx.strokeStyle="#0F0",this.ctx.lineWidth=5,this.ctx.rect((this.cvs.width-e-5)/2,(this.cvs.height-e-5)/2,e+5,e+5),this.ctx.stroke(),this.outCtx.drawImage(this.cvs,(this.cvs.width-e)/2,(this.cvs.height-e)/2,e,e,0,0,224,224)}},{key:"captureWebcam",value:function(){return navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){return e}):Promise.reject(new Error("Native web camera streaming (getUserMedia) not supported in this browser."))}},{key:"componentWillUpdate",value:function(e,t){t.model.modelName!==this.state.model.modelName&&this.loadClassifier(t.model.modelName)}},{key:"componentDidMount",value:function(){var e=this,t=[window.innerWidth,window.innerHeight];this.cvs.width=t[0],this.cvs.height=t[1],this.ctx=this.cvs.getContext("2d"),document.body.addEventListener("keydown",this.handleKeyPress,!1),document.body.addEventListener("keyup",this.handleKeyPressUp,!1),this.loadClassifier(),this.captureWebcam().then(function(t){e.webCamLoaded(t)}),this.outCtx=this.outCnv.getContext("2d")}},{key:"loadFrozen",value:function(){var e=this,t=new w;t.init().then(function(){e.setState({classifier:t})})}},{key:"loadClassifier",value:function(e){var t=this,n=new g({hostname:"https://dashbouquet.github.io/computer-vision-demos/models/",useMobileNet:!1});n.loadModel(e||this.state.model.modelName).then(function(){console.warn("READY TO CLASSIFY"),t.setState({classifier:n})}).catch(function(e){console.log(e)})}},{key:"render",value:function(){var e=this,t=this.state.model,n=Array.from(this.state.predIndex)||[],s=t.labels,r=n.length>0?n.map(function(e,t){return[e,t]}).reduce(function(e,t){return t[0]>e[0]?t:e})[1]:0,i=t.explainers[r];return a.a.createElement(a.a.Fragment,null,1===this.state.gestIndex?a.a.createElement("p",{className:"palmDetected"},"PALM"):null,a.a.createElement("div",{className:"statsTable"},t&&n.map(function(e,t){return a.a.createElement("div",{key:t},a.a.createElement("div",{style:{width:"".concat(x(e),"%"),backgroundColor:"green",whiteSpace:"nowrap"}},s[t]," ",x(e),"%"))})),a.a.createElement("canvas",{tabIndex:"0",key:"cvsMain",className:"canvas",ref:function(t){e.cvs=t}}),a.a.createElement("canvas",{key:"cvsSecondary",className:"tmpCanvas",ref:function(t){e.outCnv=t},width:"224",height:"224"}),t&&a.a.createElement("img",{src:"/models/".concat(this.state.model.modelName,"/").concat(i),className:"detectionExplainer",alt:"Explainer"}),a.a.createElement("select",{onChange:function(t){var n;console.log(t.target.value),n=t.target.value,e.setState({model:y[n]})},className:"modelsSwitcher"},y.map(function(e,t){return a.a.createElement("option",{key:t,value:t},e.description)})))}}]),t}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(184);i.a.render(a.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},89:function(e,t,n){e.exports=n(186)},99:function(e,t){}},[[89,2,1]]]);
//# sourceMappingURL=main.f4e1b48b.chunk.js.map