{"version":3,"sources":["models/classifier.js","models/frozen.js","Models.js","App.js","serviceWorker.js","index.js"],"names":["ClassifierApi","config","Object","classCallCheck","this","hostname","useMobileNet","mobilenet","classifier","modelName","loadClassifier","tf","listModels","modelsInfo","console","log","keys","length","filter","modelPath","includes","split","dispose","fetchModel","layer","getLayer","inputs","outputs","output","Error","_context3","t0","model","_context4","idbModelExists","concat","save","then","catch","err","warn","imageData","normalizeImage","input","predict","predictedClass","webcamImage","_this","cropImage","expandDims","toFloat","div","sub","img","size","Math","min","shape","beginHeight","beginWidth","slice","_this2","as1D","data","palmConfidence","Frozen","ASSETS_URL","MODEL_URL","WEIGHTS_URL","IMAGE_SIZE","labels","loadFrozenModel","executeAsync","performance","now","image","resized","resizeBilinear","offset","normalized","predictions","map","label","index","accuracy","sort","a","b","time","toFixed","loadModel","Models","description","explainers","toPercent","score","App","possibleConstructorReturn","getPrototypeOf","call","handleKeyPress","event","listenKeys","saveSnaps","key","handleKeyPressUp","snapsPerSecond","predictionsPerSecond","predictionQueueCap","state","gestIndex","predIndex","models","gestureLoading","gestureLast","Date","snapLast","snapsInProcessing","snapShot","bind","assertThisInitialized","classifyBox","video","cnv","_ref","window","innerWidth","innerHeight","width","height","webcamRatio","videoWidth","videoHeight","style","top","left","stream","document","createElement","srcObject","display","body","appendChild","onloadedmetadata","e","setup","cvs","play","ctx","updateDetectBoxes","requestAnimationFrame","_this3","classifyImage","outCnv","res","setState","boxSize","drawImage","strokeStyle","lineWidth","rect","stroke","outCtx","navigator","mediaDevices","getUserMedia","Promise","reject","nextProps","nextState","_this4","_ref2","getContext","addEventListener","captureWebcam","objectUrl","webCamLoaded","_this5","frozen","init","_this6","_this7","detections","Array","from","currentDetectionIndex","x","i","reduce","r","explainer","react_default","Fragment","className","v","backgroundColor","whiteSpace","tabIndex","ref","src","alt","onChange","evt","modelIndex","target","value","Component","Boolean","location","match","ReactDOM","render","src_App_0","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.f4e1b48b.chunk.js","sourcesContent":["import * as tf from '@tensorflow/tfjs';\n\nclass ClassifierApi {\n  constructor(config) {\n    this.hostname = config.hostname;\n    this.useMobileNet = config.useMobileNet;\n    this.mobilenet = false;\n    this.classifier = false;\n    this.modelName = false;\n  }\n  async loadModel(modelName) {\n    //if (this.useMobileNet) await this.loadMobileNet()\n    await this.loadClassifier(modelName);\n  }\n\n  async idbModelExists(modelName) {\n    const modelsInfo = await tf.io.listModels();\n    console.log(Object.keys(modelsInfo));\n    if (Object.keys(modelsInfo).length === 0) return false;\n\n    return (\n      Object.keys(modelsInfo).filter((modelPath) => {\n        return (\n          modelPath.includes('indexeddb') &&\n          modelPath.split('://')[1] === modelName\n        );\n      }).length > 0\n    );\n  }\n\n  async loadMobileNet() {\n    try {\n      if (this.mobilenet) this.mobilenet.dispose();\n\n      const mobilenet = await this.fetchModel('mobileNet');\n      const layer = mobilenet.getLayer('conv_pw_13_relu');\n      this.mobilenet = tf.model({\n        inputs: mobilenet.inputs,\n        outputs: layer.output\n      });\n\n      console.log('mobileNet loaded');\n    } catch (e) {\n      throw new Error(e);\n    }\n  }\n\n  async loadClassifier(modelName) {\n    try {\n      const model = await this.fetchModel(modelName);\n      this.classifier = model;\n      this.modelName = modelName;\n      console.log('classifier loaded');\n    } catch (e) {\n      throw new Error(e);\n    }\n  }\n\n  async fetchModel(modelName) {\n    const modelExists = await this.idbModelExists(modelName);\n\n    if (modelExists) {\n      console.log(`Loading ${modelName} from IDB`);\n      const model = await tf.loadModel(`indexeddb://${modelName}`);\n      return model;\n    } else {\n      console.log(`Loading ${modelName} from local server`);\n      const model = await tf.loadModel(\n        `${this.hostname}/${modelName}/model.json`\n      );\n\n      model\n        .save(`indexeddb://${modelName}`)\n        .then(() => console.log(`${modelName} saved to IDB`))\n        .catch((err) => console.warn(err));\n      return model;\n    }\n  }\n\n  async classifyImage(imageData) {\n    if (!this.classifier || (this.useMobileNet && !this.mobilenet))\n      return false;\n\n    let input = await this.normalizeImage(imageData);\n\n    const predictedClass = await this.predict(input);\n    return predictedClass;\n  }\n\n  async normalizeImage(imageData) {\n    return tf.tidy(() => {\n      const webcamImage = tf.fromPixels(imageData);\n      const croppedImage = this.cropImage(webcamImage);\n\n      const batchedImage = croppedImage.expandDims(0);\n\n      return batchedImage\n        .toFloat()\n        .div(tf.scalar(127))\n        .sub(tf.scalar(1));\n    });\n  }\n\n  cropImage(img) {\n    const size = Math.min(img.shape[0], img.shape[1]);\n    const centerHeight = img.shape[0] / 2;\n    const beginHeight = centerHeight - size / 2;\n    const centerWidth = img.shape[1] / 2;\n    const beginWidth = centerWidth - size / 2;\n    return img.slice([beginHeight, beginWidth, 0], [size, size, 3]);\n  }\n\n  async predict(input) {\n    const predictedClass = tf.tidy(() => {\n      if (this.useMobileNet) input = this.mobilenet.predict(input);\n      const predictions = this.classifier.predict(input);\n\n      return predictions.as1D();\n    });\n\n    let palmConfidence = await predictedClass.data();\n    predictedClass.dispose();\n\n    return palmConfidence;\n  }\n}\n\nexport default ClassifierApi;\n","import * as tf from '@tensorflow/tfjs';\nimport { loadFrozenModel } from '@tensorflow/tfjs-converter';\n\nclass Frozen {\n  constructor() {\n    this.ASSETS_URL = `http://127.0.0.1:8085/nnModels/`;\n    this.MODEL_URL = `${\n      this.ASSETS_URL\n    }/converted-sessionmodel/tensorflowjs_model.pb`;\n    this.WEIGHTS_URL = `${\n      this.ASSETS_URL\n    }/converted-sessionmodel/weights_manifest.json`;\n    this.IMAGE_SIZE = 224;\n    this.labels = ['closed', 'opened'];\n    this.model = false;\n  }\n\n  async loadModel() {\n    const model = await loadFrozenModel(this.MODEL_URL, this.WEIGHTS_URL);\n    // Warm up GPU\n    const input = tf.zeros([1, this.IMAGE_SIZE, this.IMAGE_SIZE, 3]);\n    await model.executeAsync({ input }); // MobileNet V1\n    //model.predict({ Placeholder: input }) // MobileNet V2\n\n    return model;\n  }\n\n  async classifyImage(img) {\n    const t0 = performance.now();\n    const image = tf.fromPixels(img).toFloat();\n    const resized = tf.image.resizeBilinear(image, [\n      this.IMAGE_SIZE,\n      this.IMAGE_SIZE\n    ]);\n    const offset = tf.scalar(255 / 2);\n    const normalized = resized.sub(offset).div(offset);\n    const input = normalized.expandDims(0);\n    const output = await tf.tidy(() => this.model.predict({ input })).data(); // MobileNet V1\n    //const output = await tf.tidy(() => this.model.predict({ Placeholder: input })).data() // MobileNet V2\n    const predictions = this.labels\n      .map((label, index) => ({ label, accuracy: output[index] }))\n      .sort((a, b) => b.accuracy - a.accuracy);\n    const time = `${(performance.now() - t0).toFixed(1)} ms`;\n    return { predictions, time };\n  }\n\n  async init() {\n    this.model = await this.loadModel();\n    //const predictions = await this.predict(input)\n    //console.log(predictions)\n  }\n}\nexport default Frozen;\n","export default [\n  {\n    description: \"Open hand recognition\",\n    modelName: \"hands2-93-0.9880\",\n    labels: [\"close\", \"open\"],\n    explainers: [\"classes/closed.jpg\", \"classes/opened.jpg\"]\n  },\n\n  {\n    description: \"Open hand & fingers recognition (very raw)\",\n    modelName: 'handsMulti-47-0.8496',\n    labels: ['0','1','2','3','4','5','6','7','8','9','q','w','x','z'],\n    explainers: [\n      \"classes/0.jpg\", \n      \"classes/1.jpg\", \n      \"classes/2.jpg\", \n      \"classes/3.jpg\",\n      \"classes/4.jpg\",\n      \"classes/5.jpg\",\n      \"classes/6.jpg\",\n      \"classes/7.jpg\",\n      \"classes/8.jpg\",\n      \"classes/9.jpg\",\n      \"classes/q.jpg\",\n      \"classes/w.jpg\",\n      \"classes/x.jpg\",]\n  }\n];\n","import React, { Component } from 'react';\nimport ClassifierApi from './models/classifier';\nimport Frozen from './models/frozen';\nimport './App.css';\n\nimport models from './Models';\n\nconst argMax = (array) => array.map((x, i) => [x, i]).reduce((r, a) => (a[0] > r[0] ? a : r))[1];\n\nconst toPercent = (score) => (score * 100).toFixed(2);\n\nconst getModelsPath = () => process.env.NODE_ENV === 'production' ? 'https://dashbouquet.github.io/computer-vision-demos/models/' : `models`;\n\nclass App extends Component {\n  constructor() {\n    super();\n\n    // Config\n    this.snapsPerSecond = 3;\n    this.predictionsPerSecond = 10;\n    this.predictionQueueCap = 5;\n    this.listenKeys = true;\n\n    this.state = {\n      classifier: false,\n      gestIndex: 0,\n      predIndex: [],\n      model: models[0]\n    };\n\n    this.gestureLoading = false;\n    this.gestureLast = Date.now();\n    this.snapLast = Date.now();\n    this.saveSnaps = null;\n    this.snapsInProcessing = 0;\n\n    this.snapShot = this.snapShot.bind(this);\n    this.classifyBox = this.classifyBox.bind(this);\n  }\n\n  setup(video, cnv) {\n    const [width, height] = [window.innerWidth, window.innerHeight];\n    const webcamRatio = video.videoWidth / video.videoHeight;\n    const aspectRatio = width / height;\n\n    if (webcamRatio > aspectRatio) {\n      cnv.width = width;\n      cnv.height = width / webcamRatio;\n      cnv.style.top = 0 - (cnv.height / 2 - height / 2);\n    } else {\n      cnv.height = height;\n      cnv.width = height * webcamRatio;\n      cnv.style.left = 0 - (cnv.width / 2 - width / 2);\n    }\n  }\n\n  webCamLoaded(stream) {\n    this.video = document.createElement('video');\n    this.video.srcObject = stream;\n    this.video.style.display = 'none';\n    document.body.appendChild(this.video);\n\n    this.video.onloadedmetadata = (e) => {\n      this.setup(this.video, this.cvs);\n      this.video.play();\n      this.snapShot();\n    };\n  }\n\n  async snapShot() {\n    if (this.ctx) {\n      this.updateDetectBoxes();\n      if (this.state.classifier) {\n        this.classifyBox();\n      }\n    }\n\n    requestAnimationFrame(this.snapShot);\n  }\n\n  printScore(score) {\n    console.log(\n      `%c${(score * 100).toFixed(2)}% (${this.snapsInProcessing})`,\n      'margin-left: 15px; color: blue; font-size:15px; background: white; padding: 5px; border-radius: 5px;'\n    );\n  }\n\n  classifyBox() {\n    if (\n      !this.gestureLoading &&\n      Date.now() - this.gestureLast > 1000 / this.predictionsPerSecond &&\n      this.snapsInProcessing < this.predictionQueueCap\n    ) {\n      this.snapsInProcessing++;\n      this.gestureLoading = true;\n      this.gestureLast = Date.now();\n      this.state.classifier.classifyImage(this.outCnv).then((res) => {\n        this.snapsInProcessing--;\n        this.gestureLoading = false;\n        this.setState({ predIndex: res });\n      });\n    }\n  }\n\n  updateDetectBoxes() {\n    const boxSize = window.innerHeight / 2;\n    const border = 5;\n    this.ctx.drawImage(this.video, 0, 0, this.cvs.width, this.cvs.height);\n\n    this.ctx.strokeStyle = '#0F0';\n    this.ctx.lineWidth = border;\n    this.ctx.rect(\n      (this.cvs.width - boxSize - border) / 2,\n      (this.cvs.height - boxSize - border) / 2,\n      boxSize + border,\n      boxSize + border\n    );\n    this.ctx.stroke();\n\n    this.outCtx.drawImage(\n      this.cvs,\n      (this.cvs.width - boxSize) / 2,\n      (this.cvs.height - boxSize) / 2,\n      boxSize,\n      boxSize,\n      0,\n      0,\n      224,\n      224\n    );\n  }\n\n  captureWebcam() {\n    if (navigator.mediaDevices) {\n      return navigator.mediaDevices\n        .getUserMedia({ video: true })\n        .then((stream) => stream);\n    } else {\n      return Promise.reject(\n        new Error(\n          'Native web camera streaming (getUserMedia) not supported in this browser.'\n        )\n      );\n    }\n  }\n\n  handleKeyPress = (event) => {\n    if (this.listenKeys && this.saveSnaps !== event.key) {\n      this.saveSnaps = event.key;\n      console.log(`Saving images of ${event.key} class`);\n    }\n  };\n\n  handleKeyPressUp = (event) => {\n    this.saveSnaps = null;\n  };\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextState.model.modelName !== this.state.model.modelName) {\n      this.loadClassifier(nextState.model.modelName);\n    }\n  }\n\n  componentDidMount() {\n    [this.cvs.width, this.cvs.height] = [window.innerWidth, window.innerHeight];\n    this.ctx = this.cvs.getContext('2d');\n\n    document.body.addEventListener('keydown', this.handleKeyPress, false);\n    document.body.addEventListener('keyup', this.handleKeyPressUp, false);\n\n    this.loadClassifier();\n\n    this.captureWebcam().then((objectUrl) => {\n      this.webCamLoaded(objectUrl);\n    });\n\n    this.outCtx = this.outCnv.getContext('2d');\n  }\n\n  loadFrozen() {\n    const frozen = new Frozen();\n    frozen.init().then(() => {\n      this.setState({ classifier: frozen });\n    });\n  }\n\n  loadClassifier(model) {\n    const classifier = new ClassifierApi({\n      hostname: getModelsPath(),\n      useMobileNet: false\n    });\n\n    classifier\n      .loadModel(model || this.state.model.modelName )\n      .then(() => {\n        console.warn('READY TO CLASSIFY');\n        this.setState({ classifier });\n      })\n      .catch((e) => {\n        console.log(e);\n      });\n  }\n\n  render() {\n    const model = this.state.model;\n    const detections = Array.from(this.state.predIndex) || [];\n    const labels = model.labels;\n    const currentDetectionIndex = detections.length > 0 ? argMax(detections) : 0;\n    const explainer = model.explainers[currentDetectionIndex];\n    const changeModel = (modelIndex) => {\n      this.setState({model: models[modelIndex]}); \n    }\n\n    return (\n      <React.Fragment>\n        {this.state.gestIndex === 1 ? (\n          <p className=\"palmDetected\">PALM</p>\n        ) : null}\n          <div className=\"statsTable\">\n            {model && detections.map((v, i) => (<div key={i}><div style={{width: `${toPercent(v)}%`, backgroundColor: 'green', whiteSpace: 'nowrap'}}>{labels[i]} {toPercent(v)}%</div></div>))}\n          </div>\n        <canvas\n          tabIndex=\"0\"\n          key={'cvsMain'}\n          className=\"canvas\"\n          ref={(cvs) => {\n            this.cvs = cvs;\n          }}\n        />\n        <canvas\n          key={'cvsSecondary'}\n          className=\"tmpCanvas\"\n          ref={(outCnv) => {\n            this.outCnv = outCnv;\n          }}\n          width=\"224\"\n          height=\"224\"\n        />\n        {model && <img src={`/models/${this.state.model.modelName}/${explainer}`} className=\"detectionExplainer\" alt=\"Explainer\"/>}\n        <select onChange={(evt) => { console.log(evt.target.value); changeModel(evt.target.value) }} className=\"modelsSwitcher\">\n          {models.map((model, i) => (<option key={i} value={i}>{model.description}</option>))}\n        </select>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport './index.css';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}